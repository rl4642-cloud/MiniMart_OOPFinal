@startuml MiniMart Sequence Diagram - System Initialization

title MiniMart - System Initialization Sequence Diagram

actor "Store Manager" as Manager
participant "Main" as Main
participant "MiniMart" as MiniMart
participant "Product" as Product
participant "Transaction" as Transaction
participant "ArrayList<Product>" as ProductList
participant "ArrayList<Transaction>" as TransactionList
database "File System" as Files

== System Initialization ==
Manager -> Main: start application
activate Main
Main -> MiniMart: new MiniMart()
activate MiniMart
MiniMart -> MiniMart: new ArrayList<Product>()
MiniMart -> MiniMart: new ArrayList<Transaction>()
MiniMart -> MiniMart: new Scanner(System.in)
MiniMart -> MiniMart: loadData()
activate MiniMart

== Load Products ==
MiniMart -> MiniMart: loadProducts()
activate MiniMart
MiniMart -> Files: check if products.bin exists
alt file exists
    MiniMart -> Files: open ObjectInputStream
    Files --> MiniMart: file stream
    MiniMart -> Files: readInt() - productCount
    Files --> MiniMart: productCount
    MiniMart -> Product: setProductCount(productCount)
    MiniMart -> Files: readInt() - nextId
    Files --> MiniMart: nextId
    MiniMart -> Product: setNextId(nextId)
    loop for each product
        MiniMart -> Files: readObject()
        Files --> MiniMart: Product object
        MiniMart -> ProductList: add(product)
    end
    MiniMart -> Files: close stream
    MiniMart -> System.out: print "Loaded X products"
else file does not exist
    MiniMart -> System.out: print "Starting with empty catalog"
end
deactivate MiniMart

== Load Transactions ==
MiniMart -> MiniMart: loadTransactions()
activate MiniMart
MiniMart -> Files: check if transactions.bin exists
alt file exists
    MiniMart -> Files: open ObjectInputStream
    Files --> MiniMart: file stream
    MiniMart -> Files: readInt() - transactionCount
    Files --> MiniMart: transactionCount
    MiniMart -> Transaction: setTransactionCount(transactionCount)
    MiniMart -> Files: readInt() - nextTransactionId
    Files --> MiniMart: nextTransactionId
    MiniMart -> Transaction: setNextTransactionId(nextTransactionId)
    loop for each transaction
        MiniMart -> Files: readObject()
        Files --> MiniMart: Transaction object
        MiniMart -> TransactionList: add(transaction)
    end
    MiniMart -> Files: close stream
    MiniMart -> System.out: print "Loaded X transactions"
end
deactivate MiniMart
deactivate MiniMart
MiniMart --> Main: MiniMart instance
deactivate MiniMart
Main -> MiniMart: run()
activate MiniMart
MiniMart --> Manager: display main menu

@enduml

