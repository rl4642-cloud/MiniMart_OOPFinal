@startuml MiniMart Sequence Diagram - Record Sale

title MiniMart - Record Sale Sequence Diagram

actor "Store Manager" as Manager
participant "MiniMart" as MiniMart
participant "Product" as Product
participant "Transaction" as Transaction
participant "ArrayList<Product>" as ProductList
participant "ArrayList<Transaction>" as TransactionList
participant "Scanner" as Scanner
database "File System" as Files
participant "System.out" as Console

== Record Sale Flow ==
Manager -> MiniMart: select option (5) from submenu
activate MiniMart
MiniMart -> MiniMart: recordSale()
activate MiniMart

== Display Products ==
MiniMart -> ProductList: isEmpty()
ProductList --> MiniMart: false
MiniMart -> MiniMart: displayAllProducts()
loop for each product
    MiniMart -> Product: displayProduct()
    Product -> Console: printf(...)
end

== Get User Input ==
Manager -> MiniMart: enter product ID
MiniMart -> Scanner: nextLine()
Scanner --> MiniMart: productIdString (String)
MiniMart -> MiniMart: Integer.parseInt(productIdString)
MiniMart --> MiniMart: productId (int)

== Find Product ==
MiniMart -> MiniMart: findProductById(productId)
MiniMart --> MiniMart: Product found

Manager -> MiniMart: enter quantity
MiniMart -> Scanner: nextLine()
Scanner --> MiniMart: quantityString (String)
MiniMart -> MiniMart: Integer.parseInt(quantityString)
MiniMart --> MiniMart: quantity (int)

== Validate Stock ==
MiniMart -> Product: getStockQuantity()
Product --> MiniMart: currentStock (int)

alt sufficient stock
    == Process Sale ==
    MiniMart -> Product: decreaseStock(quantity)
    activate Product
    Product -> Product: check if stockQuantity >= quantity
    Product -> Product: stockQuantity -= quantity
    Product --> MiniMart: true (success)
    deactivate Product
    
    == Calculate Profit ==
    MiniMart -> Product: getSellingPrice()
    Product --> MiniMart: sellingPrice
    MiniMart -> Product: getPurchasePrice()
    Product --> MiniMart: purchasePrice
    MiniMart -> MiniMart: revenue = quantity * sellingPrice
    MiniMart -> MiniMart: profit = quantity * (sellingPrice - purchasePrice)
    
    == Create Transaction ==
    MiniMart -> Product: getId()
    Product --> MiniMart: productId
    MiniMart -> Product: getName()
    Product --> MiniMart: productName
    
    MiniMart -> Transaction: new Transaction(SALE, productId, name, quantity, sellingPrice)
    activate Transaction
    Transaction -> Transaction: nextTransactionId++
    Transaction -> Transaction: assign transactionId
    Transaction -> Transaction: totalAmount = quantity * unitPrice
    Transaction -> Transaction: transactionCount++
    Transaction --> MiniMart: new Transaction instance
    deactivate Transaction
    
    MiniMart -> TransactionList: add(sale)
    
    == Save Data ==
    MiniMart -> MiniMart: saveProducts()
    MiniMart -> Files: write products to file
    MiniMart -> MiniMart: saveTransactions()
    MiniMart -> Files: write transactions to file
    
    == Confirmation ==
    MiniMart -> Console: print sale details
    MiniMart -> Product: getStockQuantity()
    Product --> MiniMart: newStockLevel
    MiniMart -> Console: print "Sale recorded successfully!"
    MiniMart -> Console: print revenue and profit
    MiniMart -> Scanner: nextLine() - wait for Enter
    MiniMart --> Manager: return to inventory overview
    
else insufficient stock
    == Error Handling ==
    MiniMart -> Console: print "ERROR: Insufficient stock!"
    MiniMart -> Console: print available stock
    MiniMart -> Console: print requested quantity
    MiniMart -> Console: print "Sale rejected"
    MiniMart -> Scanner: nextLine() - wait for Enter
    MiniMart --> Manager: return to inventory overview
end

deactivate MiniMart
deactivate MiniMart

@enduml

