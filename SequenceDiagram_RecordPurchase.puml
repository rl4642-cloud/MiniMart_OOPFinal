@startuml MiniMart Sequence Diagram - Record Purchase

title MiniMart - Record Purchase (Restocking) Sequence Diagram

actor "Store Manager" as Manager
participant "MiniMart" as MiniMart
participant "Product" as Product
participant "Transaction" as Transaction
participant "ArrayList<Product>" as ProductList
participant "ArrayList<Transaction>" as TransactionList
participant "Scanner" as Scanner
database "File System" as Files
participant "System.out" as Console

== Record Purchase Flow ==
Manager -> MiniMart: select option (4) from submenu
activate MiniMart
MiniMart -> MiniMart: recordPurchase()
activate MiniMart

== Display Products ==
MiniMart -> ProductList: isEmpty()
ProductList --> MiniMart: false
MiniMart -> MiniMart: displayAllProducts()
activate MiniMart
loop for each product
    MiniMart -> Product: displayProduct()
    Product -> Console: printf(...)
end
deactivate MiniMart

== Get User Input ==
Manager -> MiniMart: enter product ID
MiniMart -> Scanner: nextLine()
Scanner --> MiniMart: productIdString (String)
MiniMart -> MiniMart: Integer.parseInt(productIdString)
MiniMart --> MiniMart: productId (int)

== Find Product ==
MiniMart -> MiniMart: findProductById(productId)
activate MiniMart
loop for each product in list
    MiniMart -> Product: getId()
    Product --> MiniMart: id
    alt id matches
        MiniMart --> MiniMart: return Product
    end
end
deactivate MiniMart
MiniMart --> MiniMart: Product found

Manager -> MiniMart: enter quantity
MiniMart -> Scanner: nextLine()
Scanner --> MiniMart: quantityString (String)
MiniMart -> MiniMart: Integer.parseInt(quantityString)
MiniMart --> MiniMart: quantity (int)

== Update Stock ==
MiniMart -> Product: increaseStock(quantity)
activate Product
Product -> Product: stockQuantity += quantity
Product --> MiniMart: stock updated
deactivate Product

== Create Transaction ==
MiniMart -> Product: getId()
Product --> MiniMart: productId
MiniMart -> Product: getName()
Product --> MiniMart: productName
MiniMart -> Product: getPurchasePrice()
Product --> MiniMart: purchasePrice

MiniMart -> Transaction: new Transaction(PURCHASE, productId, name, quantity, purchasePrice)
activate Transaction
Transaction -> Transaction: nextTransactionId++
Transaction -> Transaction: assign transactionId
Transaction -> Transaction: totalAmount = quantity * unitPrice
Transaction -> Transaction: transactionCount++
Transaction --> MiniMart: new Transaction instance
deactivate Transaction

MiniMart -> TransactionList: add(purchase)

== Save Data ==
MiniMart -> MiniMart: saveProducts()
activate MiniMart
MiniMart -> Files: new ObjectOutputStream(PRODUCTS_FILE)
MiniMart -> Files: writeInt(products.size())
MiniMart -> Files: writeInt(Product.getNextId())
loop for each product
    MiniMart -> Files: writeObject(product)
end
MiniMart -> Files: flush()
MiniMart -> Files: close()
deactivate MiniMart

MiniMart -> MiniMart: saveTransactions()
activate MiniMart
MiniMart -> Files: new ObjectOutputStream(TRANSACTIONS_FILE)
MiniMart -> Files: writeInt(transactions.size())
MiniMart -> Files: writeInt(Transaction.getNextTransactionId())
loop for each transaction
    MiniMart -> Files: writeObject(transaction)
end
MiniMart -> Files: flush()
MiniMart -> Files: close()
deactivate MiniMart

== Confirmation ==
MiniMart -> Console: print purchase details
MiniMart -> Product: getStockQuantity()
Product --> MiniMart: newStockLevel
MiniMart -> Console: print "Purchase recorded successfully!"
MiniMart -> Scanner: nextLine() - wait for Enter
MiniMart --> Manager: return to inventory overview
deactivate MiniMart
deactivate MiniMart

@enduml

